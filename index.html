<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TK Coin - Trading & Wallet App (Firebase)</title>
    <style>
        :root {
            --primary: #ff6600; /* Orange */
            --primary-dark: #cc5200;
            --bg-dark: #121212;
            --bg-card: #1e1e1e;
            --text-light: #e0e0e0;
            --text-muted: #a0a0a0;
            --success: #00c853;
            --danger: #ff3d00;
            --blue: #2979ff;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: var(--bg-dark);
            color: var(--text-light);
            overflow-x: hidden;
            padding-bottom: 70px; /* Space for bottom nav */
        }

        /* --- Utility & Components --- */
        .hidden { display: none !important; }
        .text-orange { color: var(--primary); }
        .text-blue { color: var(--blue); }
        .text-green { color: var(--success); }
        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            width: 100%;
            transition: 0.2s;
        }
        .btn:hover { background: var(--primary-dark); }
        .btn:disabled { background: #555; cursor: not-allowed; }
        .btn-outline { background: transparent; border: 1px solid var(--primary); color: var(--primary); }
        .btn-sm { padding: 5px 10px; font-size: 0.8rem; width: auto; }
        
        .input-group { margin-bottom: 15px; }
        .input-group label { display: block; margin-bottom: 5px; color: var(--text-muted); font-size: 0.9rem; }
        .input-group input, .input-group select {
            width: 100%;
            padding: 12px;
            background: #2a2a2a;
            border: 1px solid #333;
            color: white;
            border-radius: 6px;
            outline: none;
        }
        .input-group input:focus { border-color: var(--primary); }

        /* --- Toast Notification --- */
        #toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
        }
        .toast {
            background: var(--bg-card);
            border-left: 4px solid var(--primary);
            color: white;
            padding: 15px 20px;
            margin-bottom: 10px;
            border-radius: 4px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            animation: slideIn 0.3s ease;
        }
        @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }

        /* --- Auth Screen --- */
        #auth-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background: linear-gradient(135deg, #121212, #2a1b0d);
        }
        .auth-box {
            background: var(--bg-card);
            padding: 30px;
            border-radius: 12px;
            width: 90%;
            max-width: 400px;
            border-top: 3px solid var(--primary);
        }
        .auth-toggle { text-align: center; margin-top: 15px; font-size: 0.9rem; cursor: pointer; color: var(--primary); }

        /* --- Main Layout --- */
        header {
            background: var(--bg-card);
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #333;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .logo { font-size: 1.2rem; font-weight: bold; color: var(--primary); display: flex; align-items: center; gap: 5px; }
        .user-info { display: flex; align-items: center; gap: 10px; font-size: 0.9rem; cursor: pointer; }
        .avatar { width: 35px; height: 35px; border-radius: 50%; background: #333; object-fit: cover; }
        
        /* --- Navigation --- */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            width: 100%;
            background: var(--bg-card);
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            border-top: 1px solid #333;
            z-index: 100;
        }
        .nav-item {
            color: var(--text-muted);
            text-decoration: none;
            font-size: 0.8rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
        }
        .nav-item.active { color: var(--primary); }
        .nav-item i { font-size: 1.2rem; margin-bottom: 2px; }

        /* --- Sections --- */
        .section { padding: 15px; max-width: 600px; margin: 0 auto; }
        
        /* Market Chart */
        .chart-container {
            background: var(--bg-card);
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
            position: relative;
            height: 200px;
            border: 1px solid #333;
        }
        #marketCanvas { width: 100%; height: 100%; }
        .ticker-wrap {
            width: 100%;
            background: #000;
            overflow: hidden;
            padding: 8px 0;
            white-space: nowrap;
            border-bottom: 1px solid var(--primary);
        }
        .ticker { display: inline-block; animation: ticker 20s linear infinite; }
        .ticker-item { display: inline-block; padding: 0 20px; font-size: 0.9rem; }
        @keyframes ticker { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }

        /* Wallet Cards */
        .balance-card {
            background: linear-gradient(135deg, var(--primary), #ff9100);
            color: #fff;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 10px rgba(255, 102, 0, 0.3);
        }
        .balance-title { font-size: 0.9rem; opacity: 0.9; }
        .balance-amount { font-size: 2rem; font-weight: bold; margin: 5px 0; }
        
        .menu-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; }
        .menu-card {
            background: var(--bg-card);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: 0.2s;
            border: 1px solid #333;
        }
        .menu-card:hover { border-color: var(--primary); transform: translateY(-3px); }
        .menu-icon { font-size: 1.5rem; margin-bottom: 10px; display: block; }

        /* Chat */
        .chat-box {
            background: var(--bg-card);
            height: 60vh;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            border: 1px solid #333;
        }
        .chat-messages { flex: 1; overflow-y: auto; padding: 10px; display: flex; flex-direction: column; gap: 10px; }
        .message { max-width: 80%; padding: 8px 12px; border-radius: 10px; font-size: 0.9rem; word-wrap: break-word;}
        .msg-admin { align-self: flex-start; background: #333; color: white; }
        .msg-user { align-self: flex-end; background: var(--primary); color: white; }
        .chat-input-area { padding: 10px; display: flex; gap: 10px; border-top: 1px solid #333; }

        /* Admin Styles */
        .admin-table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.85rem; }
        .admin-table th, .admin-table td { text-align: left; padding: 8px; border-bottom: 1px solid #333; }
        .admin-table th { color: var(--primary); }
        .status-badge { padding: 2px 6px; border-radius: 4px; font-size: 0.7rem; }
        .status-pending { background: #ff9800; color: black; }
        .status-approved { background: #00c853; color: white; }
        .status-rejected { background: #ff3d00; color: white; }

        /* Premium Badge */
        .badge-premium { color: var(--blue); margin-left: 5px; }
        .blue-tick { color: #1da1f2; margin-left: 2px; }
        
        /* Loader */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--primary);
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 1s linear infinite;
            display: inline-block;
            vertical-align: middle;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    </style>
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>

    <!-- Toast Notifications -->
    <div id="toast-container"></div>

    <!-- Auth Screen -->
    <div id="auth-screen">
        <div class="auth-box">
            <h2 class="text-orange" style="text-align: center; margin-bottom: 20px;">TK Coin Login</h2>
            <form id="auth-form">
                <div class="input-group">
                    <label>Email</label>
                    <input type="email" id="auth-email" required placeholder="admin@app.com or user">
                </div>
                <div class="input-group">
                    <label>Password</label>
                    <input type="password" id="auth-pass" required placeholder="password">
                </div>
                <button type="submit" class="btn" id="auth-btn">Login</button>
            </form>
            <div class="auth-toggle" onclick="toggleAuthMode()">Don't have an account? Signup</div>
            <div style="margin-top: 15px; font-size: 0.8rem; color: #666; text-align: center;">
                Hint: Admin: admin@app.com / admin123
            </div>
        </div>
    </div>

    <!-- Main App Container -->
    <div id="app-container" class="hidden">
        
        <!-- News Ticker -->
        <div class="ticker-wrap">
            <div class="ticker" id="news-ticker">
                <!-- News injected by JS -->
            </div>
        </div>

        <header>
            <div class="logo">
                <i class="fas fa-coins"></i> TK Coin
                <span id="header-premium-badge" class="hidden blue-tick"><i class="fas fa-check-circle"></i></span>
            </div>
            <div class="user-info" onclick="showSection('profile')">
                <div style="text-align: right;">
                    <div id="header-name">User</div>
                    <div id="header-balance" style="color: var(--primary);">0 TK</div>
                </div>
                <img src="https://picsum.photos/seed/user/50/50" class="avatar" id="header-avatar" alt="User">
            </div>
        </header>

        <!-- User Views -->
        <main id="user-views">
            
            <!-- Dashboard / Market -->
            <section id="view-market" class="section">
                <div class="balance-card">
                    <div class="balance-title">Current TK Price</div>
                    <div class="balance-amount"><span id="market-price">0.00</span> USD</div>
                    <small style="opacity: 0.8;">+2.4% (24h)</small>
                </div>

                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h3>Live Market</h3>
                    <span style="font-size: 0.8rem; color: var(--success);">‚óè Live</span>
                </div>
                
                <div class="chart-container">
                    <canvas id="marketCanvas"></canvas>
                </div>

                <div style="margin-top: 20px;">
                    <h3>Live Rates</h3>
                    <div style="display: flex; justify-content: space-between; background: var(--bg-card); padding: 15px; margin-top: 10px; border-radius: 8px;">
                        <div>
                            <div style="font-size: 0.8rem; color: #aaa;">1 USDT</div>
                            <div style="font-weight: bold;" id="rate-usdt">Loading...</div>
                        </div>
                        <div>
                            <div style="font-size: 0.8rem; color: #aaa;">1 TK</div>
                            <div style="font-weight: bold;" id="rate-pkr">Loading...</div>
                        </div>
                    </div>
                </div>

                <div style="margin-top: 20px;">
                    <h3>News Feed</h3>
                    <div id="news-feed" style="display: flex; flex-direction: column; gap: 10px; margin-top: 10px;">
                        <!-- News items -->
                    </div>
                </div>
            </section>

            <!-- Wallet -->
            <section id="view-wallet" class="section hidden">
                <div class="balance-card">
                    <div class="balance-title">Total Balance</div>
                    <div class="balance-amount"><span id="wallet-tk">0</span> TK</div>
                    <div style="font-size: 1rem; opacity: 0.9;"><span id="wallet-pkr">0</span> PKR</div>
                </div>

                <div class="menu-grid">
                    <div class="menu-card" onclick="showSection('deposit')">
                        <span class="menu-icon text-orange"><i class="fas fa-wallet"></i></span>
                        <div>Deposit</div>
                    </div>
                    <div class="menu-card" onclick="showSection('withdraw')">
                        <span class="menu-icon text-green"><i class="fas fa-money-bill-wave"></i></span>
                        <div>Withdraw</div>
                    </div>
                    <div class="menu-card" onclick="showSection('transfer')">
                        <span class="menu-icon text-blue"><i class="fas fa-exchange-alt"></i></span>
                        <div>Transfer</div>
                    </div>
                    <div class="menu-card" onclick="showSection('premium')">
                        <span class="menu-icon" style="color: gold;"><i class="fas fa-crown"></i></span>
                        <div>Pro</div>
                    </div>
                </div>

                <h3>Transaction History</h3>
                <div id="transaction-list" style="margin-top: 10px; display: flex; flex-direction: column; gap: 10px;">
                    <!-- History -->
                </div>
            </section>

            <!-- Deposit -->
            <section id="view-deposit" class="section hidden">
                <h2 class="text-orange">Deposit Funds</h2>
                <p style="color: #aaa; margin-bottom: 20px;">Select method to add balance.</p>
                
                <div class="input-group">
                    <label>Method</label>
                    <select id="deposit-method" onchange="updateDepositDetails()">
                        <option value="easypaisa">Easypaisa</option>
                        <option value="jazzcash">JazzCash</option>
                        <option value="usdt">USDT (TRC20)</option>
                    </select>
                </div>

                <div style="background: var(--bg-card); padding: 15px; border-radius: 8px; margin-bottom: 20px; border: 1px solid #333;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <div style="font-size: 0.8rem; color: #aaa;">Deposit To:</div>
                            <div style="font-weight: bold; font-size: 1.1rem;" id="deposit-number">0300-1234567</div>
                            <div style="font-size: 0.8rem; color: var(--primary);" id="deposit-name">Ali Khan - Easypaisa</div>
                        </div>
                        <button class="btn btn-sm btn-outline" onclick="copyDepositNumber()"><i class="fas fa-copy"></i></button>
                    </div>
                </div>

                <div class="input-group">
                    <label>Amount Sent (PKR)</label>
                    <input type="number" id="deposit-amount" oninput="calculateDeposit()" placeholder="e.g. 1000">
                </div>
                <div class="input-group">
                    <label>Reference No / Transaction ID</label>
                    <input type="text" id="deposit-ref" placeholder="TRX ID">
                </div>

                <div style="background: #222; padding: 10px; border-radius: 6px; margin-bottom: 20px;">
                    <small>You will receive: <strong><span id="deposit-calc-receive">0</span> TK</strong></small>
                </div>

                <button class="btn" onclick="submitDeposit()">Submit Deposit Request</button>
                <button class="btn btn-outline" style="margin-top: 10px;" onclick="showSection('wallet')">Back</button>
            </section>

            <!-- Withdraw -->
            <section id="view-withdraw" class="section hidden">
                <h2 class="text-orange">Withdraw Funds</h2>
                <p style="color: #aaa; margin-bottom: 20px;">Withdraw TK to Easypaisa, JazzCash or USDT.</p>

                <div style="background: var(--bg-card); padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <div>Available Balance: <strong id="withdraw-bal-display">0 TK</strong></div>
                    <div style="font-size: 0.8rem; color: var(--primary);" id="fee-display">Fee: 5%</div>
                </div>

                <div class="input-group">
                    <label>Method</label>
                    <select id="withdraw-method">
                        <option value="easypaisa">Easypaisa</option>
                        <option value="jazzcash">JazzCash</option>
                        <option value="usdt">USDT</option>
                    </select>
                </div>

                <div class="input-group">
                    <label>Account Number / Address</label>
                    <input type="text" id="withdraw-account" placeholder="0300...">
                </div>

                <div class="input-group">
                    <label>Amount (TK)</label>
                    <input type="number" id="withdraw-amount" placeholder="Min 50 TK">
                </div>

                <button class="btn" onclick="submitWithdraw()">Request Withdrawal</button>
                <button class="btn btn-outline" style="margin-top: 10px;" onclick="showSection('wallet')">Back</button>
            </section>

            <!-- Transfer -->
            <section id="view-transfer" class="section hidden">
                <h2 class="text-orange">Transfer Coins</h2>
                <p style="color: #aaa; margin-bottom: 20px;">Send TK to another user instantly.</p>

                <div class="input-group">
                    <label>Receiver Email</label>
                    <input type="email" id="transfer-email" placeholder="user@example.com">
                </div>
                <div class="input-group">
                    <label>Amount (TK)</label>
                    <input type="number" id="transfer-amount" placeholder="Amount">
                </div>

                <button class="btn" onclick="submitTransfer()">Send Now</button>
                <button class="btn btn-outline" style="margin-top: 10px;" onclick="showSection('wallet')">Back</button>
            </section>

            <!-- Premium -->
            <section id="view-premium" class="section hidden">
                <div style="text-align: center; margin-bottom: 20px;">
                    <i class="fas fa-crown" style="font-size: 4rem; color: gold; margin-bottom: 15px;"></i>
                    <h2>Go Premium</h2>
                    <p>Unlock Zero Fee, Blue Tick & VIP Features.</p>
                </div>

                <div class="balance-card" style="text-align: center;">
                    <div class="balance-title">Upgrade Cost</div>
                    <div class="balance-amount">100 TK</div>
                    <div style="margin-top: 10px;">
                        <i class="fas fa-check-circle"></i> 0% Withdraw Fee<br>
                        <i class="fas fa-check-circle"></i> Premium Badge<br>
                        <i class="fas fa-check-circle"></i> Special Access
                    </div>
                </div>

                <button class="btn" id="btn-upgrade" onclick="upgradePremium()">Upgrade Now</button>
                <button class="btn btn-outline" style="margin-top: 10px;" onclick="showSection('wallet')">Back</button>
            </section>

            <!-- Chat -->
            <section id="view-chat" class="section hidden">
                <h2>Live Support</h2>
                <div class="chat-box">
                    <div class="chat-messages" id="chat-messages">
                        <!-- Msgs -->
                    </div>
                    <div class="chat-input-area">
                        <input type="text" id="chat-input" placeholder="Type a message..." style="flex: 1; padding: 8px; border-radius: 4px; border: none; background: #333; color: white;">
                        <button class="btn btn-sm" onclick="sendChatMessage()"><i class="fas fa-paper-plane"></i></button>
                    </div>
                </div>
            </section>

            <!-- Profile -->
            <section id="view-profile" class="section hidden">
                <div style="text-align: center; margin-bottom: 20px;">
                    <img src="https://picsum.photos/seed/user/100/100" class="avatar" style="width: 100px; height: 100px; margin-bottom: 10px;" id="profile-avatar">
                    <h2 id="profile-name">User Name</h2>
                    <p id="profile-email" style="color: #aaa;">user@email.com</p>
                    <div id="profile-status" style="margin-top: 5px; font-size: 0.9rem; color: var(--primary);">Standard User</div>
                </div>

                <h3>Settings</h3>
                <div class="menu-card" onclick="showAboutModal()" style="text-align: left; margin-bottom: 10px;">
                    <i class="fas fa-info-circle"></i> About App
                </div>
                <button class="btn" style="background: #333;" onclick="logout()">Logout</button>
            </section>
        </main>

        <!-- Admin Views -->
        <main id="admin-views" class="hidden">
            <section id="view-admin-dashboard" class="section">
                <h2 class="text-orange">Admin Dashboard</h2>
                
                <div class="menu-grid" style="margin-top: 20px;">
                    <div class="menu-card" onclick="showAdminSection('market')">
                        <span class="menu-icon text-orange"><i class="fas fa-chart-line"></i></span>
                        <div>Market</div>
                    </div>
                    <div class="menu-card" onclick="showAdminSection('deposits')">
                        <span class="menu-icon text-green"><i class="fas fa-check-double"></i></span>
                        <div>Deposits <span id="admin-dep-pending-count" class="badge" style="background:red; padding:2px 5px; border-radius:50%; font-size:0.7rem; color:white;">0</span></div>
                    </div>
                    <div class="menu-card" onclick="showAdminSection('users')">
                        <span class="menu-icon text-blue"><i class="fas fa-users"></i></span>
                        <div>Users</div>
                    </div>
                    <div class="menu-card" onclick="showAdminSection('news')">
                        <span class="menu-icon"><i class="fas fa-newspaper"></i></span>
                        <div>News</div>
                    </div>
                </div>

                <div class="menu-card" onclick="showAdminSection('chat')" style="text-align: left; margin-bottom: 20px;">
                    <span class="menu-icon"><i class="fas fa-comments"></i></span>
                    <div>Live Support Chats</div>
                </div>
            </section>

            <!-- Admin: Market Control -->
            <section id="admin-market" class="section hidden">
                <button class="btn btn-sm btn-outline" onclick="showAdminSection('dashboard')">Back</button>
                <h3 class="text-orange" style="margin-top: 15px;">Market Control</h3>
                <div class="input-group">
                    <label>TK Price (USD)</label>
                    <input type="number" id="admin-tk-price" onchange="adminUpdateMarket()">
                </div>
                <div class="input-group">
                    <label>USDT to PKR Rate</label>
                    <input type="number" id="admin-usdt-rate" onchange="adminUpdateMarket()">
                </div>
                <div class="input-group">
                    <label>Market Mode</label>
                    <select id="admin-market-mode" onchange="adminUpdateMarket()">
                        <option value="auto">Auto (Random)</option>
                        <option value="manual">Manual</option>
                    </select>
                </div>
            </section>

            <!-- Admin: Deposits -->
            <section id="admin-deposits" class="section hidden">
                <button class="btn btn-sm btn-outline" onclick="showAdminSection('dashboard')">Back</button>
                <h3 class="text-orange" style="margin-top: 15px;">Deposit Approvals</h3>
                <div style="overflow-x: auto;">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>User</th>
                                <th>Method</th>
                                <th>Amount</th>
                                <th>Ref</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="admin-deposit-list">
                            <!-- Rows -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Admin: Users -->
            <section id="admin-users" class="section hidden">
                <button class="btn btn-sm btn-outline" onclick="showAdminSection('dashboard')">Back</button>
                <h3 class="text-orange" style="margin-top: 15px;">User Management</h3>
                <div style="overflow-x: auto;">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Balance</th>
                                <th>Role</th>
                            </tr>
                        </thead>
                        <tbody id="admin-user-list">
                            <!-- Rows -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Admin: News -->
            <section id="admin-news" class="section hidden">
                <button class="btn btn-sm btn-outline" onclick="showAdminSection('dashboard')">Back</button>
                <h3 class="text-orange" style="margin-top: 15px;">Post News</h3>
                <div class="input-group">
                    <label>Headline</label>
                    <input type="text" id="admin-news-headline">
                </div>
                <button class="btn" onclick="postNews()">Post Update</button>
            </section>

             <!-- Admin: Chat -->
             <section id="admin-chat" class="section hidden">
                <button class="btn btn-sm btn-outline" onclick="showAdminSection('dashboard')">Back</button>
                <h3 class="text-orange" style="margin-top: 15px;">User Chats</h3>
                <div id="admin-chat-list">
                    <!-- List of users to chat with -->
                </div>
                <div id="admin-chat-window" class="chat-box hidden">
                     <div class="chat-messages" id="admin-chat-messages"></div>
                     <div class="chat-input-area">
                         <input type="text" id="admin-chat-input" placeholder="Reply...">
                         <button class="btn btn-sm" onclick="adminSendReply()">Reply</button>
                     </div>
                </div>
            </section>

        </main>

        <!-- Bottom Navigation (User Only) -->
        <nav class="bottom-nav" id="user-nav">
            <a class="nav-item active" onclick="showSection('market')">
                <i class="fas fa-chart-line"></i>
                <span>Market</span>
            </a>
            <a class="nav-item" onclick="showSection('wallet')">
                <i class="fas fa-wallet"></i>
                <span>Wallet</span>
            </a>
            <a class="nav-item" onclick="showSection('chat')">
                <i class="fas fa-comment-dots"></i>
                <span>Chat</span>
            </a>
            <a class="nav-item" onclick="showSection('profile')">
                <i class="fas fa-user"></i>
                <span>Profile</span>
            </a>
        </nav>
    </div>

    <!-- Scripts -->
    <script type="module">
        // Import Firebase SDKs
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-analytics.js";
        import { 
            getAuth, 
            createUserWithEmailAndPassword, 
            signInWithEmailAndPassword, 
            onAuthStateChanged, 
            signOut 
        } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";
        import { 
            getDatabase, 
            ref, 
            set, 
            push, 
            onValue, 
            update, 
            get, 
            child 
        } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-database.js";

        // Your Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCBMk5ED0YNL9MqVThgMhoOuWvGwTgCJCg",
            authDomain: "injector-c964a.firebaseapp.com",
            databaseURL: "https://injector-c964a-default-rtdb.firebaseio.com",
            projectId: "injector-c964a",
            storageBucket: "injector-c964a.firebasestorage.app",
            messagingSenderId: "746006402839",
            appId: "1:746006402839:web:26d14a3fee7d6e6cc68952",
            measurementId: "G-DBMSEZZWW1"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const auth = getAuth(app);
        const db = getDatabase(app);

        // --- GLOBAL STATE ---
        let currentUserData = null; // Holds snapshot of current user from DB
        let allUsers = {};
        let marketData = { tkPrice: 1.50, usdtRate: 280, mode: 'auto' };
        let appSettings = {
            easypaisa: '0300-1234567',
            jazzcash: '0321-7654321',
            usdt: 'TRC20Address...',
            minWithdraw: 50,
            withdrawFee: 0.05
        };
        let adminSelectedChatUser = null; // For admin chat

        // --- UTILITIES ---
        window.showToast = (msg, type = 'success') => {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.style.borderLeftColor = type === 'error' ? 'var(--danger)' : 'var(--primary)';
            toast.innerText = msg;
            container.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        function getAdminEmail() {
            return "admin@app.com";
        }

        // --- INITIALIZATION ---
        function initApp() {
            // Auth Listener
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    // User logged in
                    checkAndCreateUserInDB(user);
                } else {
                    // User logged out
                    document.getElementById('auth-screen').classList.remove('hidden');
                    document.getElementById('app-container').classList.add('hidden');
                    currentUserData = null;
                }
            });

            // Market & Settings Listeners (Global)
            onValue(ref(db, 'market'), (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    marketData = data;
                    updateMarketUI();
                }
            });

            onValue(ref(db, 'settings'), (snapshot) => {
                const data = snapshot.val();
                if (data) {
                    appSettings = data;
                    updateDepositDetails(); // Refresh if on deposit page
                }
            });

            // News Listener
            onValue(ref(db, 'news'), (snapshot) => {
                const newsList = document.getElementById('news-feed');
                const ticker = document.getElementById('news-ticker');
                newsList.innerHTML = "";
                ticker.innerHTML = "";
                
                const data = snapshot.val();
                if (data) {
                    Object.values(data).reverse().forEach((news, index) => {
                        // News Feed
                        newsList.innerHTML += `
                            <div style="background:var(--bg-card); padding:10px; border-radius:6px; border:1px solid #333;">
                                <div style="font-weight:bold; color:#fff;">${news.title}</div>
                                <div style="font-size:0.8rem; color:#777;">${news.date}</div>
                            </div>
                        `;
                        // Ticker
                        ticker.innerHTML += `<span class="ticker-item">${news.title}</span>`;
                    });
                }
            });
        }

        // --- USER CREATION IN DB ---
        function checkAndCreateUserInDB(firebaseUser) {
            const userRef = ref(db, 'users/' + firebaseUser.uid);
            
            get(userRef).then((snapshot) => {
                if (snapshot.exists()) {
                    currentUserData = snapshot.val();
                    currentUserData.uid = firebaseUser.uid; // Keep uid handy
                    loginSuccess(currentUserData);
                } else {
                    // Create new user record
                    const isAdmin = firebaseUser.email === getAdminEmail();
                    const newUser = {
                        name: firebaseUser.email.split('@')[0],
                        email: firebaseUser.email,
                        role: isAdmin ? "admin" : "user",
                        isPremium: isAdmin ? true : false,
                        balanceTK: isAdmin ? 10000 : 0,
                        balancePKR: 0,
                        avatar: `https://picsum.photos/seed/${firebaseUser.uid}/50/50`,
                        createdAt: new Date().toISOString()
                    };
                    set(userRef, newUser).then(() => {
                        currentUserData = newUser;
                        currentUserData.uid = firebaseUser.uid;
                        loginSuccess(currentUserData);
                    });
                }
            });
        }

        // --- AUTH LOGIC ---
        let isSignup = false;
        window.toggleAuthMode = () => {
            isSignup = !isSignup;
            document.querySelector('.auth-box h2').innerText = isSignup ? "Create Account" : "TK Coin Login";
            document.getElementById('auth-btn').innerText = isSignup ? "Signup" : "Login";
            document.querySelector('.auth-toggle').innerText = isSignup ? "Already have an account? Login" : "Don't have an account? Signup";
        };

        document.getElementById('auth-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('auth-email').value;
            const pass = document.getElementById('auth-pass').value;
            const btn = document.getElementById('auth-btn');
            
            btn.innerText = "Processing...";
            btn.disabled = true;

            try {
                if (isSignup) {
                    await createUserWithEmailAndPassword(auth, email, pass);
                    showToast("Account created successfully!");
                } else {
                    await signInWithEmailAndPassword(auth, email, pass);
                    showToast("Login successful!");
                }
            } catch (error) {
                showToast(error.message, "error");
            } finally {
                btn.innerText = isSignup ? "Signup" : "Login";
                btn.disabled = false;
            }
        });

        window.logout = () => {
            signOut(auth).then(() => {
                showToast("Logged out");
            });
        };

        // --- APP NAVIGATION & UI ---
        function loginSuccess(user) {
            document.getElementById('auth-screen').classList.add('hidden');
            document.getElementById('app-container').classList.remove('hidden');

            // Listen to THIS user's specific data for real-time updates
            onValue(ref(db, 'users/' + user.uid), (snapshot) => {
                currentUserData = snapshot.val();
                currentUserData.uid = user.uid;
                updateUI();
            });

            if (user.role === 'admin') {
                document.getElementById('user-nav').classList.add('hidden');
                document.getElementById('user-views').classList.add('hidden');
                document.getElementById('admin-views').classList.remove('hidden');
                showAdminSection('dashboard');
            } else {
                document.getElementById('user-nav').classList.remove('hidden');
                document.getElementById('user-views').classList.remove('hidden');
                document.getElementById('admin-views').classList.add('hidden');
                showSection('market');
            }
        }

        window.showSection = (sectionId) => {
            document.querySelectorAll('#user-views .section').forEach(el => el.classList.add('hidden'));
            document.getElementById(`view-${sectionId}`).classList.remove('hidden');
            
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            const navIndex = ['market', 'wallet', 'chat', 'profile'].indexOf(sectionId);
            if (navIndex >= 0) document.querySelectorAll('.nav-item')[navIndex].classList.add('active');

            if (sectionId === 'chat') loadUserChat();
        };

        window.showAdminSection = (sectionId) => {
            document.querySelectorAll('#admin-views .section').forEach(el => el.classList.add('hidden'));
            
            if(sectionId === 'dashboard') {
                document.getElementById('view-admin-dashboard').classList.remove('hidden');
            } else {
                document.getElementById(`admin-${sectionId}`).classList.remove('hidden');
            }

            if (sectionId === 'deposits') loadAdminDeposits();
            if (sectionId === 'users') loadAdminUsers();
            if (sectionId === 'market') loadAdminMarket();
            if (sectionId === 'chat') loadAdminChatList();
        };

        function updateUI() {
            if (!currentUserData) return;

            // Header
            document.getElementById('header-name').innerText = currentUserData.name;
            document.getElementById('header-balance').innerText = currentUserData.balanceTK.toFixed(2) + " TK";
            document.getElementById('header-avatar').src = currentUserData.avatar;

            // Profile
            document.getElementById('profile-name').innerText = currentUserData.name;
            document.getElementById('profile-email').innerText = currentUserData.email;
            document.getElementById('profile-avatar').src = currentUserData.avatar;

            if (currentUserData.isPremium) {
                document.getElementById('profile-status').innerHTML = `<span class="text-blue"><i class="fas fa-check-circle blue-tick"></i> Premium User</span>`;
                document.getElementById('header-premium-badge').classList.remove('hidden');
            } else {
                document.getElementById('profile-status').innerText = "Standard User";
                document.getElementById('header-premium-badge').classList.add('hidden');
            }

            // Wallet
            const pkrValue = currentUserData.balanceTK * marketData.usdtRate;
            document.getElementById('wallet-tk').innerText = currentUserData.balanceTK.toFixed(2);
            document.getElementById('wallet-pkr').innerText = pkrValue.toFixed(2);

            // Withdraw Fee
            const fee = currentUserData.isPremium ? 0 : appSettings.withdrawFee * 100;
            document.getElementById('fee-display').innerText = `Fee: ${fee}%`;
            document.getElementById('withdraw-bal-display').innerText = currentUserData.balanceTK.toFixed(2) + " TK";

            // History (Deposits for this user)
            renderHistory();
        }

        // --- MARKET LOGIC ---
        function updateMarketUI() {
            document.getElementById('market-price').innerText = marketData.tkPrice.toFixed(2);
            document.getElementById('rate-usdt').innerText = marketData.usdtRate + " PKR";
            document.getElementById('rate-pkr').innerText = (marketData.tkPrice * marketData.usdtRate).toFixed(2) + " PKR";
            
            drawChart();

            // Auto update Admin inputs if they are open
            const adminPriceInput = document.getElementById('admin-tk-price');
            if(adminPriceInput) adminPriceInput.value = marketData.tkPrice;
            const adminRateInput = document.getElementById('admin-usdt-rate');
            if(adminRateInput) adminRateInput.value = marketData.usdtRate;
            const adminModeSelect = document.getElementById('admin-market-mode');
            if(adminModeSelect) adminModeSelect.value = marketData.mode;
        }

        // Simulated Loop for Market Auto Mode (Only admin writes, but we simulate locally for visual)
        setInterval(() => {
            if (marketData.mode === 'auto') {
                const change = (Math.random() - 0.5) * 0.05;
                let newPrice = Math.max(0.1, marketData.tkPrice + change);
                // Write to DB so everyone sees it
                update(ref(db, 'market'), {
                    tkPrice: newPrice,
                    usdtRate: marketData.usdtRate,
                    mode: 'auto'
                });
            }
        }, 3000);

        function drawChart() {
            const canvas = document.getElementById('marketCanvas');
            const ctx = canvas.getContext('2d');
            canvas.width = canvas.parentElement.offsetWidth;
            canvas.height = canvas.parentElement.offsetHeight;

            const points = [];
            let price = marketData.tkPrice;
            for(let i=0; i<20; i++) {
                points.unshift(price);
                price = price * (1 + (Math.random() - 0.5) * 0.05);
            }
            points.push(marketData.tkPrice);

            const max = Math.max(...points) * 1.05;
            const min = Math.min(...points) * 0.95;
            const range = max - min;
            const stepX = canvas.width / (points.length - 1);

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.beginPath();
            ctx.strokeStyle = '#ff6600';
            ctx.lineWidth = 2;

            points.forEach((p, i) => {
                const x = i * stepX;
                const y = canvas.height - ((p - min) / range) * canvas.height;
                if(i===0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            });
            ctx.stroke();
        }

        // --- WALLET FUNCTIONS ---
        window.updateDepositDetails = () => {
            const method = document.getElementById('deposit-method').value;
            const displayNum = document.getElementById('deposit-number');
            const displayName = document.getElementById('deposit-name');
            
            if (method === 'easypaisa') { displayNum.innerText = appSettings.easypaisa; displayName.innerText = "Ali Khan - Easypaisa"; }
            else if (method === 'jazzcash') { displayNum.innerText = appSettings.jazzcash; displayName.innerText = "Ali Khan - JazzCash"; }
            else { displayNum.innerText = appSettings.usdt; displayName.innerText = "USDT (TRC20)"; }
            calculateDeposit();
        };

        window.calculateDeposit = () => {
            const pkr = parseFloat(document.getElementById('deposit-amount').value) || 0;
            const receive = pkr / marketData.usdtRate;
            document.getElementById('deposit-calc-receive').innerText = receive.toFixed(2);
        };

        window.copyDepositNumber = () => {
            navigator.clipboard.writeText(document.getElementById('deposit-number').innerText);
            showToast("Copied!");
        };

        window.submitDeposit = () => {
            const amount = parseFloat(document.getElementById('deposit-amount').value);
            const refId = document.getElementById('deposit-ref').value;
            const method = document.getElementById('deposit-method').value;

            if (!amount || amount < 100) return showToast("Min deposit 100 PKR", "error");
            if (!refId) return showToast("Enter Transaction ID", "error");

            const receiveTk = amount / marketData.usdtRate;

            const depositData = {
                userId: currentUserData.uid,
                userEmail: currentUserData.email,
                method: method,
                amount: receiveTk,
                ref: refId,
                date: new Date().toLocaleString(),
                status: 'pending'
            };

            push(ref(db, 'deposits'), depositData).then(() => {
                showToast("Request Submitted!");
                document.getElementById('deposit-amount').value = '';
                document.getElementById('deposit-ref').value = '';
                showSection('wallet');
            });
        };

        window.submitWithdraw = () => {
            const amount = parseFloat(document.getElementById('withdraw-amount').value);
            const method = document.getElementById('withdraw-method').value;
            const account = document.getElementById('withdraw-account').value;

            if (!amount || amount < appSettings.minWithdraw) return showToast("Min withdraw " + appSettings.minWithdraw, "error");
            if (!account) return showToast("Enter details", "error");

            const feeRate = currentUserData.isPremium ? 0 : appSettings.withdrawFee;
            const fee = amount * feeRate;
            const total = amount + fee;

            if (total > currentUserData.balanceTK) return showToast("Insufficient balance", "error");

            // Deduct Balance Locally (Optimistic UI) + DB Transaction
            const updates = {};
            updates['users/' + currentUserData.uid + '/balanceTK'] = currentUserData.balanceTK - total;
            
            const withdrawData = {
                userId: currentUserData.uid,
                userEmail: currentUserData.email,
                method: method,
                account: account,
                amount: amount,
                fee: fee,
                date: new Date().toLocaleString(),
                status: 'pending'
            };

            const newWithdrawKey = push(child(ref(db), 'withdrawals')).key;
            updates['withdrawals/' + newWithdrawKey] = withdrawData;

            update(ref(db), updates).then(() => {
                showToast("Withdrawal Requested!");
                document.getElementById('withdraw-amount').value = '';
                document.getElementById('withdraw-account').value = '';
                showSection('wallet');
            });
        };

        window.submitTransfer = () => {
            const email = document.getElementById('transfer-email').value;
            const amount = parseFloat(document.getElementById('transfer-amount').value);

            if (!email || email === currentUserData.email) return showToast("Invalid email", "error");
            if (!amount || amount <= 0) return showToast("Invalid amount", "error");
            if (amount > currentUserData.balanceTK) return showToast("Insufficient balance", "error");

            // Find receiver UID by Email (Requires loading all users, simplified here by logic)
            // In a real app, index emails. Here we iterate cached users if available or query.
            // For simplicity in this structure, we assume we iterate.
            
            get(ref(db, 'users')).then((snapshot) => {
                let receiverUid = null;
                if (snapshot.exists()) {
                    snapshot.forEach((childSnapshot) => {
                        if (childSnapshot.val().email === email) {
                            receiverUid = childSnapshot.key;
                        }
                    });
                }

                if (receiverUid) {
                    const updates = {};
                    updates['users/' + currentUserData.uid + '/balanceTK'] = currentUserData.balanceTK - amount;
                    updates['users/' + receiverUid + '/balanceTK'] = (snapshot.val()[receiverUid].balanceTK || 0) + amount;

                    update(ref(db), updates).then(() => {
                        showToast("Transfer Successful!");
                        document.getElementById('transfer-amount').value = '';
                        document.getElementById('transfer-email').value = '';
                        showSection('wallet');
                    });
                } else {
                    showToast("User not found", "error");
                }
            });
        };

        window.upgradePremium = () => {
            if (currentUserData.balanceTK >= 100) {
                update(ref(db, 'users/' + currentUserData.uid), {
                    balanceTK: currentUserData.balanceTK - 100,
                    isPremium: true
                }).then(() => showToast("Upgraded!"));
            } else {
                showToast("Need 100 TK", "error");
            }
        };

        // --- CHAT SYSTEM ---
        function loadUserChat() {
            const chatRef = ref(db, 'chats/' + currentUserData.uid);
            onValue(chatRef, (snapshot) => {
                const container = document.getElementById('chat-messages');
                container.innerHTML = "";
                const data = snapshot.val();
                
                if (!data) {
                    container.innerHTML = `<div style="text-align:center; color:#777; margin-top:20px;">Start conversation.</div>`;
                    return;
                }

                Object.values(data).forEach(msg => {
                    const cls = msg.sender === 'admin' ? 'msg-admin' : 'msg-user';
                    container.innerHTML += `<div class="message ${cls}">${msg.text}</div>`;
                });
                container.scrollTop = container.scrollHeight;
            });
        }

        window.sendChatMessage = () => {
            const input = document.getElementById('chat-input');
            const text = input.value;
            if (!text) return;

            push(ref(db, 'chats/' + currentUserData.uid), {
                sender: 'user',
                text: text,
                time: Date.now()
            }).then(() => {
                input.value = "";
            });
        };

        // --- ADMIN FUNCTIONS ---
        window.adminUpdateMarket = () => {
            const newPrice = parseFloat(document.getElementById('admin-tk-price').value);
            const newRate = parseFloat(document.getElementById('admin-usdt-rate').value);
            const newMode = document.getElementById('admin-market-mode').value;

            update(ref(db, 'market'), {
                tkPrice: newPrice,
                usdtRate: newRate,
                mode: newMode
            }).then(() => showToast("Market Updated"));
        };

        window.postNews = () => {
            const headline = document.getElementById('admin-news-headline').value;
            if(headline) {
                push(ref(db, 'news'), {
                    title: headline,
                    date: new Date().toLocaleDateString()
                });
                document.getElementById('admin-news-headline').value = '';
                showToast("News Posted");
            }
        };

        function loadAdminDeposits() {
            const tbody = document.getElementById('admin-deposit-list');
            onValue(ref(db, 'deposits'), (snapshot) => {
                tbody.innerHTML = "";
                let count = 0;
                const data = snapshot.val();
                
                if(data) {
                    Object.entries(data).reverse().forEach(([key, d]) => {
                        if (d.status === 'pending') {
                            count++;
                            tbody.innerHTML += `
                            <tr>
                                <td>${d.userEmail}</td>
                                <td>${d.method}</td>
                                <td>${d.amount.toFixed(2)}</td>
                                <td>${d.ref}</td>
                                <td>
                                    <button class="btn-sm" style="background:green; color:white;" onclick="handleDeposit('${key}', 'approved')">‚úî</button>
                                    <button class="btn-sm" style="background:red; color:white;" onclick="handleDeposit('${key}', 'rejected')">‚úñ</button>
                                </td>
                            </tr>`;
                        }
                    });
                }
                if (count === 0) tbody.innerHTML = "<tr><td colspan='5'>No pending deposits</td></tr>";
                document.getElementById('admin-dep-pending-count').innerText = count;
            });
        }

        window.handleDeposit = (key, status) => {
            const depositRef = ref(db, 'deposits/' + key);
            get(depositRef).then((snap) => {
                const d = snap.val();
                if(d && d.status === 'pending') {
                    // Update status
                    update(depositRef, { status: status });
                    
                    // If approved, add balance to user
                    if (status === 'approved') {
                        const userRef = ref(db, 'users/' + d.userId + '/balanceTK');
                        // Transactional update needed ideally, but simple run for now
                        get(userRef).then(uSnap => {
                            const currentBal = uSnap.val() || 0;
                            set(userRef, currentBal + parseFloat(d.amount));
                        });
                    }
                    showToast(`Deposit ${status}`);
                }
            });
        };

        function loadAdminUsers() {
            const tbody = document.getElementById('admin-user-list');
            onValue(ref(db, 'users'), (snapshot) => {
                tbody.innerHTML = "";
                const data = snapshot.val();
                if(data) {
                    Object.values(data).forEach(u => {
                        tbody.innerHTML += `
                        <tr>
                            <td>${u.name}</td>
                            <td>${u.email}</td>
                            <td>${u.balanceTK.toFixed(2)}</td>
                            <td>${u.role}</td>
                        </tr>`;
                    });
                }
            });
        }

        // Admin Chat Logic
        function loadAdminChatList() {
            const listDiv = document.getElementById('admin-chat-list');
            listDiv.innerHTML = "Loading chats...";
            
            onValue(ref(db, 'chats'), (snapshot) => {
                listDiv.innerHTML = "";
                const data = snapshot.val();
                if(!data) { listDiv.innerHTML = "No chats yet."; return; }

                Object.keys(data).forEach(uid => {
                    // We need to fetch user email to show in list. 
                    // Since we are already listening to all users or might need to fetch specific.
                    // Simplified: Show UID or fetch specific.
                    get(ref(db, 'users/' + uid)).then(uSnap => {
                        const uEmail = uSnap.exists() ? uSnap.val().email : uid;
                        const btn = document.createElement('button');
                        btn.className = "btn btn-outline";
                        btn.style.marginBottom = "5px";
                        btn.style.textAlign = "left";
                        btn.innerHTML = `<i class="fas fa-user"></i> ${uEmail}`;
                        btn.onclick = () => openAdminChat(uid);
                        listDiv.appendChild(btn);
                    });
                });
            });
        }

        function openAdminChat(uid) {
            adminSelectedChatUser = uid;
            document.getElementById('admin-chat-window').classList.remove('hidden');
            const msgsDiv = document.getElementById('admin-chat-messages');
            
            onValue(ref(db, 'chats/' + uid), (snap) => {
                msgsDiv.innerHTML = "";
                const data = snap.val();
                if(data) {
                    Object.values(data).forEach(msg => {
                         const cls = msg.sender === 'admin' ? 'msg-admin' : 'msg-user';
                         // Align admin right in admin view for clarity
                         const align = msg.sender === 'admin' ? 'align-self: flex-end; background:var(--blue);' : 'align-self: flex-start; background:#333;';
                         msgsDiv.innerHTML += `<div class="message" style="${align}">${msg.text}</div>`;
                    });
                    msgsDiv.scrollTop = msgsDiv.scrollHeight;
                }
            });
        }

        window.adminSendReply = () => {
            if(!adminSelectedChatUser) return;
            const input = document.getElementById('admin-chat-input');
            const text = input.value;
            if(text) {
                push(ref(db, 'chats/' + adminSelectedChatUser), {
                    sender: 'admin',
                    text: text,
                    time: Date.now()
                });
                input.value = "";
            }
        };

        function renderHistory() {
            const list = document.getElementById('transaction-list');
            list.innerHTML = "";
            // Listen to deposits for this user
            onValue(ref(db, 'deposits'), (snapshot) => {
                list.innerHTML = "";
                const data = snapshot.val();
                if(data) {
                    Object.values(data).reverse().forEach(d => {
                        if(d.userId === currentUserData.uid) {
                            let color = d.status === 'approved' ? 'text-green' : (d.status === 'rejected' ? 'text-danger' : 'text-orange');
                            let icon = d.method === 'usdt' ? 'fa-dollar-sign' : 'fa-mobile-alt';
                            list.innerHTML += `
                            <div style="background:var(--bg-card); padding:10px; border-radius:6px; border:1px solid #333; display:flex; justify-content:space-between; align-items:center;">
                                <div style="display:flex; align-items:center; gap:10px;">
                                    <div style="background:#333; width:40px; height:40px; border-radius:50%; display:flex; align-items:center; justify-content:center;"><i class="fas ${icon} text-orange"></i></div>
                                    <div>
                                        <div style="font-weight:bold;">Deposit (${d.method})</div>
                                        <div style="font-size:0.8rem; color:#aaa;">${d.date}</div>
                                    </div>
                                </div>
                                <div style="text-align:right;">
                                    <div class="${color}">+${d.amount.toFixed(2)} TK</div>
                                    <div class="status-badge status-${d.status}">${d.status.toUpperCase()}</div>
                                </div>
                            </div>`;
                        }
                    });
                }
                if(list.innerHTML === "") list.innerHTML = "<div style='text-align:center; color:#555;'>No transactions yet.</div>";
            }, {onlyOnce: true});
        }

        // --- START ---
        initApp();
    </script>
</body>
</html>
